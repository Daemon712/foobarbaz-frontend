<div class="jumbotron" *ngIf="challenge">
  <h1 class="display-3">{{challenge.name}}</h1>
  <p class="lead">{{challenge.abstract}}</p>
  <div class="lead" *ngIf="challenge.tags">
    <span *ngFor="let tag of challenge.tags"
          class="badge badge-default mr-1">{{tag}}</span>
    <i class="fa fa-tags m-1 text-muted"></i>
  </div>
</div>
<div class="jumbotron" *ngIf="!challenge">
  <h1 class="display-3">Загрузка...</h1>
</div>
<div class="row">
  <div class="col-md-8">
    <tabset [justified]="true">
      <tab heading="Описание" class="py-3">
        <div [hidden]="challenge" class="lead text-center alert alert-info">
          <i class="fa fa-spinner fa-pulse"></i>
          <span> Загрузка...</span>
        </div>
        <div class="card" *ngIf="challenge">
          <div class="card-block text-justify" [innerHTML]="challenge.description"></div>
        </div>
      </tab>
      <tab heading="Попытки" class="py-3" [disabled]="challenge?.status === challengeStatus.NotStarted" >
        <div [hidden]="revisions" class="alert alert-info lead text-center">
          <i class="fa fa-spinner fa-pulse"></i>
          <span> Загрузка...</span>
        </div>
        <div class="card">
          <app-revision-list [revisions]="revisions">
          </app-revision-list>
        </div>
      </tab>
      <tab heading="Решение" class="py-3" (select)="openSolutionTab()">
        <div [hidden]="challenge" class="lead text-center alert alert-info">
          <i class="fa fa-spinner fa-pulse"></i>
          <span> Загрузка...</span>
        </div>
        <ace-editor class="form-control" *ngIf="challenge"
                    [(text)]="challenge.solutionTemplate"
                    [autoUpdateContent]="true"
                    [mode]="'java'" [theme]="'dreamweaver'" [options]="options">
        </ace-editor>
      </tab>
      <tab heading="Результаты тестов" class="py-3" [disabled]="!testResults">
        <div class="card">
          <app-test-results-table [testResults]="testResults">
          </app-test-results-table>
        </div>
      </tab>
    </tabset>

    <tabset type="pills" [justified]="true" *ngIf="challenge">
      <tab customClass="tab-sm tab-success pr-2" class="py-3">
        <template tabHeading>
          <i class="fa fa-plus"></i>
          <span> Комментировать</span>
        </template>
        <textarea title="comment" [(ngModel)]="newComment" class="form-control mb-2"></textarea>
        <button type="button" class="btn btn-primary btn-sm"
                [disabled]="!newComment" (click)="sendComment()">
          Оставить комментарий
        </button>
        <button type="button" class="btn btn-secondary btn-sm"
                [disabled]="!newComment" (click)="newComment = ''">
          Отмена
        </button>
      </tab>
      <tab customClass="tab-sm tab-info px-2" class="py-3"
           [disabled]="!challenge.comments && !comments?.length" (select)="loadComments()">
        <template tabHeading>
          <span>Комментарии </span>
          <i class="fa fa-comments"></i>
          <span> {{comments?.length || challenge.comments || 0}}</span>
        </template>
        <app-comments [comments]="comments" (commentLiked)="commentLiked($event)"></app-comments>
      </tab>
      <tab customClass="tab-sm tab-info pl-2" class="py-3"
           [disabled]="!challenge.sharedSolutions && !sharedSolutions?.length" (select)="loadSolutions()">
        <template tabHeading>
          <span>Опубликованные Решения </span>
          <i class="fa fa-share-alt"></i>
          <span> {{sharedSolutions?.length || challenge.sharedSolutions || 0}}</span>
        </template>
        <app-shared-solution-list [solutions]="sharedSolutions"></app-shared-solution-list>
      </tab>
    </tabset>
  </div>

  <div class="col-md-4" *ngIf="challenge">
    <div class="card mb-3" *ngIf="challenge">
      <table class="table mb-0">
        <tbody>
        <tr>
          <td>Автор</td>
          <td>
            <span class="fa fa-user"></span>
            <span>{{challenge.author}}</span>
          </td>
        </tr>
        <tr>
          <td>Дата создания</td>
          <td>
            <span>{{challenge.created | date:'d MMM yyyy'}}</span>
          </td>
        </tr>
        <tr>
          <td>Просмотры</td>
          <td>
            <span>{{challenge.views}} </span>
            <i class="fa fa-eye"></i>
          </td>
        </tr>
        <tr>
          <td>Успешные решения</td>
          <td [class.text-success]="challenge.status === challengeStatus.Completed">
            <span>{{challenge.solutions}} </span>
            <i class="fa fa-check"></i>
          </td>
        </tr>
        <tr >
          <td>Рейтинг</td>
          <td [class.text-primary]="challenge.liked">
            <span>{{challenge.likes || 0}}</span>
            <i class="fa fa-thumbs-up"></i>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <button type="submit" class="btn btn-primary my-1 w-50" title="Новое решение">
      <i class="fa fa-play"></i>
      <span> Протестировать</span>
    </button>
    <button type="submit" class="btn btn-secondary my-1 w-50" title="Новое решение">
      <i class="fa fa-save"></i>
      <span> Сохранить</span>
    </button>
    <button type="submit" class="btn btn-info my-1 w-50" title="Новое решение">
      <i class="fa fa-share-alt"></i>
      <span> Поделиться</span>
    </button>
  </div>
</div>
